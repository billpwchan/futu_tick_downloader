version: "3.8"

services:
  futu-opend:
    image: ghcr.io/manhinhang/futu-opend-docker:ubuntu-stable
    container_name: futu-opend
    restart: unless-stopped
    expose:
      - "11111"
    environment:
      - TZ=Asia/Hong_Kong

  collector:
    build:
      context: .
    container_name: hk-tick-collector
    restart: unless-stopped
    depends_on:
      - futu-opend
    environment:
      - HKTC_OPEND_HOST=futu-opend
      - HKTC_OPEND_PORT=11111
      - HKTC_SYMBOLS=${HKTC_SYMBOLS:-HK.00700}
      - HKTC_OPEND_SESSION=${HKTC_OPEND_SESSION:-ALL}
      - HKTC_DATA_DIR=/data
      - HKTC_BATCH_SIZE=${HKTC_BATCH_SIZE:-1000}
      - HKTC_MAX_WAIT_MS=${HKTC_MAX_WAIT_MS:-500}
      - HKTC_LOG_LEVEL=${HKTC_LOG_LEVEL:-INFO}
      - HKTC_BACKFILL_ENABLED=${HKTC_BACKFILL_ENABLED:-true}
      - HKTC_BACKFILL_NUM=${HKTC_BACKFILL_NUM:-200}
      - HKTC_HEALTH_ENABLED=${HKTC_HEALTH_ENABLED:-true}
      - HKTC_HEALTH_PORT=${HKTC_HEALTH_PORT:-8080}
    volumes:
      - ${HOST_SQLITE_DIR:-/data/sqlite}:/data/sqlite
      - ./config/collector.yaml:/app/config/collector.yaml:ro
    expose:
      - "8080"
